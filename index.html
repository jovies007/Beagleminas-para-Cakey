<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Beagleminas ‚Äî Buscaminas tierno</title>
<style>
  :root{
    --bg: #fff;
    --ink: #111;
    --soft-ink:#333;
    --panel:#fafafa;
    --shadow: rgba(0,0,0,.08);
    --accent-rose:#FFC7D1;
    --accent-blue:#BFE7FF;
    --accent-cream:#FFF4B8;
    --cell:#fff;
    --cell-line:#000;
    --flag:#e74c3c;
    --mine:#111;
    --focus:#111;
    --cell-size: 42px;
    --radius: 14px;
  }
  [data-theme="dark"]{
    --bg:#0f1115;
    --ink:#f2f2f2;
    --soft-ink:#d0d0d0;
    --panel:#181b22;
    --shadow: rgba(0,0,0,.28);
    --cell:#1c212b;
    --cell-line:#f2f2f2;
    --mine:#f2f2f2;
    --focus:#fff;
  }
  html,body{height:100%}
  body{
    margin:0;
    background: var(--bg);
    color: var(--ink);
    font: 16px/1.25 system-ui, "Comic Sans MS","Chalkboard SE","Bradley Hand", Segoe UI, Roboto, Arial, cursive;
    letter-spacing:.2px;
  }

  /* Marco principal */
  .wrap{
    max-width: 1100px;
    margin: 18px auto 56px;
    padding: 0 14px;
  }

  /* Encabezado */
  .topbar{
    display:flex; align-items:center; gap:12px; flex-wrap:wrap;
    background: linear-gradient(135deg, var(--panel), transparent 60%),
                radial-gradient(800px 300px at 10% -40%, var(--accent-rose), transparent 60%),
                radial-gradient(800px 300px at 110% -60%, var(--accent-blue), transparent 50%);
    border: 2px solid var(--ink);
    box-shadow: 0 6px 0 var(--shadow);
    border-radius: 18px;
    padding: 12px 14px;
  }
  .title{
    display:flex; align-items:center; gap:10px; margin-right:auto;
  }
  .title__dog{
    font-size: 26px; line-height:1;
    filter: drop-shadow(0 2px 0 var(--shadow));
    transform: translateY(1px);
  }
  .title__text{
    font-weight: 800;
    font-size: 20px;
    letter-spacing: .5px;
    text-shadow: 0 2px 0 var(--shadow);
  }

  .pill{
    display:inline-flex; align-items:center; gap:8px;
    background: var(--accent-cream);
    border: 2px solid var(--ink);
    border-radius: 999px;
    padding: 6px 10px;
    box-shadow: 0 3px 0 var(--shadow);
  }
  .pill strong{font-weight:800}
  .sep{opacity:.35}

  .btn, .select, .toggle{
    appearance:none;
    background: var(--panel);
    border: 2px solid var(--ink);
    border-radius: 12px;
    padding: 8px 12px;
    font: inherit; color: inherit;
    box-shadow: 0 3px 0 var(--shadow);
    cursor:pointer;
    transition: transform .05s ease, box-shadow .2s ease, background .2s ease, filter .2s ease;
  }
  .btn:active{ transform: translateY(1px); }
  .select{ cursor:pointer }
  .toggle{ display:inline-flex; align-items:center; gap:8px }
  .toggle input{ accent-color: var(--ink); width:18px; height:18px }

  .reset-face{
    font-size: 22px; line-height:1;
    background: var(--accent-blue);
  }
  .reset-face:active{ filter: saturate(1.1) }

  /* Panel inferior */
  .toolbar{
    margin: 10px 0 14px;
    display:flex; align-items:center; gap:10px; flex-wrap:wrap;
  }

  /* Tablero */
  .board-wrap{
    border: 3px solid var(--ink);
    border-radius: 18px;
    background:
      linear-gradient(180deg, var(--panel), transparent 220px),
      radial-gradient(900px 220px at -10% -40%, var(--accent-rose), transparent 50%),
      radial-gradient(900px 220px at 110% -60%, var(--accent-blue), transparent 50%);
    padding: 14px;
    box-shadow: 0 12px 0 var(--shadow);
    overflow:hidden;
  }
  .board{
    display:grid;
    gap: 8px;
    justify-content:center;
    touch-action: manipulation;
    user-select:none;
  }
  .cell{
    width: var(--cell-size);
    height: var(--cell-size);
    border: 2.5px solid var(--ink);
    border-radius: 10px;
    background: var(--cell);
    display:inline-flex; align-items:center; justify-content:center;
    font-weight:900;
    font-size: calc(var(--cell-size) * .44);
    cursor:pointer;
    position:relative;
    transition: transform .06s ease, background .2s ease, filter .2s ease;
  }
  .cell:hover{ filter: brightness(1.03) }
  .cell:active{ transform: translateY(1px) }
  .cell[aria-disabled="true"]{ cursor:default }

  .cell.revealed{
    background: linear-gradient(#fff0, #fff0), var(--panel);
    box-shadow: inset 0 0 0 3px var(--shadow);
  }

  .cell .flag{ font-size: .9em; transform: translateY(1px) }
  .cell .mine{ font-size: .9em }

  /* N√∫meros por color accesible */
  .n1{ color:#1976d2 }  /* azul */
  .n2{ color:#388e3c }  /* verde */
  .n3{ color:#d32f2f }  /* rojo */
  .n4{ color:#6a1b9a }  /* p√∫rpura */
  .n5{ color:#f57c00 }  /* naranja oscuro */
  .n6{ color:#00838f }  /* teal oscuro */
  .n7{ color:#455a64 }  /* gris azulado */
  .n8{ color:#000000 }  /* negro */

  /* Accesibilidad focus visible "hand-drawn" */
  .cell:focus{
    outline: none;
    box-shadow:
      0 0 0 3px var(--accent-cream),
      0 0 0 6px var(--ink);
  }

  /* Banner de estado */
  .banner{
    position: fixed;
    top: 12px; left: 50%; transform: translateX(-50%) translateY(-120%);
    background: var(--accent-rose);
    color: var(--ink);
    border: 3px solid var(--ink);
    border-radius: 14px;
    padding: 8px 14px;
    font-weight:900;
    letter-spacing:.4px;
    box-shadow: 0 8px 0 var(--shadow);
    transition: transform .35s cubic-bezier(.2, .8, .2, 1);
    z-index: 5;
  }
  .banner.show{ transform: translateX(-50%) translateY(0) }

  /* Confeti */
  .confetti{
    pointer-events:none;
    position: fixed;
    inset: 0;
    overflow: hidden;
    z-index: 6;
  }
  .confetti i{
    position:absolute; top:-10vh;
    width:10px; height:14px;
    border:2px solid var(--ink);
    border-radius:3px;
    background: var(--accent-rose);
    opacity:.95;
    animation: fall 2.6s linear forwards;
  }
  .confetti i:nth-child(3n){ background: var(--accent-blue) }
  .confetti i:nth-child(5n){ background: var(--accent-cream) }
  @keyframes fall {
    to { transform: translateY(110vh) rotate(680deg) }
  }

  /* Pie con tips teclado */
  .tips{
    margin-top:10px; opacity:.75; font-size:.92rem
  }

  /* Responsivo */
  @media (max-width: 800px){
    :root{ --cell-size: 40px }
  }
  @media (max-width: 540px){
    :root{ --cell-size: 36px }
    .title__text{ font-size: 18px }
    .cell{ border-width: 2px; border-radius: 9px }
  }
</style>
</head>
<body data-theme="light">
  <div class="wrap" id="app">
    <div class="topbar" role="region" aria-label="Controles de juego">
      <div class="title" aria-hidden="true">
        <div class="title__dog" title="boop!">üê∂‚ú®</div>
        <div class="title__text">Beagleminas</div>
      </div>

      <div class="pill" aria-live="polite">
        <span>üí£</span><strong id="mineCount">10</strong>
        <span class="sep">|</span>
        <span>‚è±Ô∏è</span><strong id="timer">000</strong>
      </div>

      <select id="difficulty" class="select" aria-label="Dificultad">
        <option value="easy">F√°cil 9√ó9 (10)</option>
        <option value="medium">Medio 16√ó16 (40)</option>
        <option value="hard">Experto 30√ó16 (99)</option>
      </select>

      <button id="resetBtn" class="btn reset-face" aria-label="Reiniciar">üôÇ</button>

      <label class="toggle" title="Modo claro/oscuro">
        <input id="themeToggle" type="checkbox" />
        <span>üåô Modo oscuro</span>
      </label>

      <label class="toggle" title="Sonidos del juego">
        <input id="soundToggle" type="checkbox" />
        <span>üîà Sonidos</span>
      </label>

      <div class="pill" title="Mejor tiempo" aria-live="polite">
        üèÜ <strong id="best">--</strong>
      </div>
    </div>

    <div class="toolbar" role="region" aria-label="Acciones r√°pidas">
      <small>Primer click seguro ¬∑ Clic primario = revelar ¬∑ Clic secundario/long-press o doble tap = üö©</small>
    </div>

    <div class="board-wrap">
      <div id="board" class="board" role="grid" aria-label="Tablero de Buscaminas"></div>
    </div>

    <p class="tips">Teclado: flechas para mover, <kbd>Enter</kbd> revelar, <kbd>F</kbd> bandera, <kbd>R</kbd> reiniciar, <kbd>M</kbd> modo oscuro. Doble clic/tap sobre un n√∫mero realiza <em>chording</em>.</p>
  </div>

  <div id="banner" class="banner" role="status" aria-live="assertive"></div>
  <div id="confetti" class="confetti" aria-hidden="true"></div>

<script>
(function(){
  "use strict";

  /** ------------------ Estado ------------------ */
  const DIFFS = {
    easy:   {w:9,  h:9,  mines:10, label:"F√°cil"},
    medium: {w:16, h:16, mines:40, label:"Medio"},
    hard:   {w:30, h:16, mines:99, label:"Experto"},
  };

  let W=9, H=9, MINES=10;
  let grid = []; // 2D: {mine, revealed, flagged, adj}
  let firstReveal = true;
  let startedAt = null, timerId = null;
  let elapsed = 0;
  let flags = 0;
  let gameOver = false;
  let soundsOn = false;
  let lastTapTime = 0; // doble tap m√≥vil
  let focusIndex = 0;  // navegaci√≥n teclado

  /** ------------------ Atajos DOM ------------------ */
  const $ = s=>document.querySelector(s);
  const boardEl = $("#board");
  const mineCountEl = $("#mineCount");
  const timerEl = $("#timer");
  const resetBtn = $("#resetBtn");
  const difficultySel = $("#difficulty");
  const bannerEl = $("#banner");
  const confettiEl = $("#confetti");
  const bestEl = $("#best");
  const themeToggle = $("#themeToggle");
  const soundToggle = $("#soundToggle");
  const appRoot = document.body;

  /** ------------------ Utilidades ------------------ */
  const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
  const idx = (x,y)=> y*W + x;
  const xyFromIndex = (i)=>({x: i%W, y: (i/W)|0});
  const inBounds = (x,y)=> x>=0 && x<W && y>=0 && y<H;

  function neighbors(x,y){
    const res=[];
    for(let dy=-1;dy<=1;dy++)
      for(let dx=-1;dx<=1;dx++){
        if(dx===0 && dy===0) continue;
        const nx=x+dx, ny=y+dy;
        if(inBounds(nx,ny)) res.push({x:nx,y:ny});
      }
    return res;
  }

  function fmtTime(t){ return String(t).padStart(3,"0") }

  function saveBestIfNeeded(){
    const key = "beaglems_best_"+difficultySel.value;
    const prev = Number(localStorage.getItem(key) || "0");
    if(prev===0 || elapsed < prev){
      localStorage.setItem(key, String(elapsed));
    }
    showBest();
  }
  function showBest(){
    const key = "beaglems_best_"+difficultySel.value;
    const v = localStorage.getItem(key);
    bestEl.textContent = v ? fmtTime(v) : "--";
  }

  /** ------------------ Sonidos (WebAudio) ------------------ */
  let audioCtx = null;
  function ensureAudio(){
    if(!audioCtx) try{ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){}
  }
  function beep(freq=600, dur=0.06, type="sine", gain=0.02){
    if(!soundsOn || !audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value=freq;
    g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    setTimeout(()=>{ o.stop(); }, dur*1000);
  }

  /** ------------------ Confeti ------------------ */
  function confettiBurst(n=40){
    confettiEl.innerHTML = "";
    const Wvw = window.innerWidth;
    for(let i=0;i<n;i++){
      const piece = document.createElement("i");
      piece.style.left = (Math.random()*Wvw|0) + "px";
      piece.style.animationDelay = (Math.random()*0.6).toFixed(2)+"s";
      piece.style.transform = `translateY(${-20 - Math.random()*40}vh) rotate(${Math.random()*360|0}deg)`;
      confettiEl.appendChild(piece);
    }
    setTimeout(()=>{ confettiEl.innerHTML=""; }, 3000);
  }

  /** ------------------ Banner ------------------ */
  let bannerTimeout=null;
  function showBanner(msg, bg){
    bannerEl.textContent = msg;
    if(bg) bannerEl.style.background = bg;
    bannerEl.classList.add("show");
    clearTimeout(bannerTimeout);
    bannerTimeout = setTimeout(()=> bannerEl.classList.remove("show"), 2000);
  }

  /** ------------------ Inicializaci√≥n tablero ------------------ */
  function setDifficulty(diffKey){
    const d = DIFFS[diffKey];
    W=d.w; H=d.h; MINES=d.mines;
    document.documentElement.style.setProperty("--cell-size", pickCellSizeForWidth(d.w));
    reset();
  }

  function pickCellSizeForWidth(w){
    // Escala el tama√±o de celda para que el tablero quepa razonablemente en pantallas chicas
    if(w >= 30) return "30px";
    if(w >= 16) return "34px";
    return "40px";
  }

  function reset(){
    // Estado base
    grid = new Array(W*H).fill(0).map(()=>({
      mine:false, revealed:false, flagged:false, adj:0
    }));
    firstReveal = true;
    startedAt = null; elapsed = 0; flags = 0; gameOver=false; focusIndex = 0;
    updateTimer(0); stopTimer();
    updateMinesLeft();
    renderBoard();
    resetBtn.textContent = "üôÇ";
    showBest();
    showBanner("¬°Nuevo juego! Suerte üêæ", null);
  }

  function placeMinesSafe(ex, ey){
    // No colocar minas en la celda (ex,ey) ni sus vecinos inmediatos
    const forbidden = new Set([idx(ex,ey)]);
    neighbors(ex,ey).forEach(n=> forbidden.add(idx(n.x,n.y)));
    let minesLeft = MINES;
    while(minesLeft>0){
      const rx = (Math.random()*W)|0;
      const ry = (Math.random()*H)|0;
      const i = idx(rx,ry);
      if(forbidden.has(i) || grid[i].mine) continue;
      grid[i].mine = true;
      minesLeft--;
    }
    // calcular adyacencias
    for(let y=0;y<H;y++){
      for(let x=0;x<W;x++){
        const i = idx(x,y);
        if(grid[i].mine){ grid[i].adj = -1; continue; }
        grid[i].adj = neighbors(x,y).reduce((a,n)=> a + (grid[idx(n.x,n.y)].mine?1:0), 0);
      }
    }
  }

  /** ------------------ Render ------------------ */
  function renderBoard(){
    boardEl.innerHTML="";
    boardEl.style.gridTemplateColumns = `repeat(${W}, var(--cell-size))`;
    boardEl.setAttribute("aria-rowcount", String(H));
    boardEl.setAttribute("aria-colcount", String(W));
    for(let y=0;y<H;y++){
      for(let x=0;x<W;x++){
        const i = idx(x,y);
        const cell = document.createElement("button");
        cell.type="button";
        cell.className = "cell";
        cell.id = "c_"+i;
        cell.setAttribute("role","gridcell");
        cell.setAttribute("aria-label","oculta");
        cell.setAttribute("data-x", x);
        cell.setAttribute("data-y", y);
        cell.setAttribute("tabindex", i===0 ? "0" : "-1");
        cell.addEventListener("click", onCellPrimary);
        cell.addEventListener("contextmenu", e=> e.preventDefault());
        cell.addEventListener("mousedown", e=>{
          if(e.button===2){ e.preventDefault(); toggleFlag(x,y); }
          // carita sorpresa al presionar
          if(!gameOver){ resetBtn.textContent = "üòÆ"; setTimeout(()=>{ if(!gameOver) resetBtn.textContent="üôÇ"; }, 110); }
        });
        cell.addEventListener("auxclick", e=>{
          if(e.button===1){ e.preventDefault(); chord(x,y); }
        });
        cell.addEventListener("dblclick", e=>{
          e.preventDefault(); chord(x,y);
        });

        // Touch: long-press = bandera; tap = revelar; doble tap = bandera
        let longPressTimer=null;
        cell.addEventListener("touchstart", e=>{
          if(gameOver) return;
          longPressTimer = setTimeout(()=>{
            toggleFlag(x,y);
            longPressTimer=null;
          }, 420);
        }, {passive:true});
        cell.addEventListener("touchend", e=>{
          if(gameOver) return;
          if(longPressTimer){
            clearTimeout(longPressTimer);
            // detectar doble tap
            const now = Date.now();
            if(now - lastTapTime < 300){
              toggleFlag(x,y);
              lastTapTime = 0;
            }else{
              lastTapTime = now;
              reveal(x,y);
            }
          }
        });

        boardEl.appendChild(cell);
        paintCell(x,y);
      }
    }
    boardEl.addEventListener("keydown", onBoardKey);
  }

  function paintCell(x,y){
    const c = grid[idx(x,y)];
    const el = document.getElementById("c_"+idx(x,y));
    if(!el) return;

    el.classList.toggle("revealed", !!c.revealed);
    el.setAttribute("aria-disabled", c.revealed ? "true" : "false");

    el.innerHTML = "";
    if(c.revealed){
      if(c.mine){
        const span = document.createElement("span");
        span.className="mine";
        span.textContent="üêæ";
        el.appendChild(span);
        el.setAttribute("aria-label","mina");
      }else if(c.adj>0){
        const span = document.createElement("span");
        span.textContent = String(c.adj);
        span.className = "n"+c.adj;
        el.appendChild(span);
        el.setAttribute("aria-label",`n√∫mero ${c.adj}`);
      }else{
        el.setAttribute("aria-label","vac√≠a");
      }
    }else if(c.flagged){
      const span = document.createElement("span");
      span.className="flag";
      span.textContent="üö©";
      el.appendChild(span);
      el.setAttribute("aria-label","bandera");
      el.title = "Bandera";
    }else{
      el.title = "";
      el.setAttribute("aria-label","oculta");
    }
  }

  function updateMinesLeft(){
    mineCountEl.textContent = String(MINES - flags);
  }

  function startTimer(){
    if(timerId) return;
    startedAt = Date.now();
    timerId = setInterval(()=>{
      elapsed = Math.min(999, ((Date.now()-startedAt)/1000)|0);
      updateTimer(elapsed);
    }, 250);
  }
  function updateTimer(t){
    timerEl.textContent = fmtTime(t);
  }
  function stopTimer(){
    clearInterval(timerId); timerId=null;
  }

  /** ------------------ Interacciones ------------------ */
  function onCellPrimary(e){
    const x = +this.getAttribute("data-x");
    const y = +this.getAttribute("data-y");
    reveal(x,y);
  }

  function toggleFlag(x,y){
    if(gameOver) return;
    const c = grid[idx(x,y)];
    if(c.revealed) return;
    c.flagged = !c.flagged;
    flags += c.flagged ? 1 : -1;
    flags = clamp(flags, 0, MINES);
    paintCell(x,y);
    updateMinesLeft();
    beep(c.flagged? 300:200, .05, "square", .03);
    checkWin();
  }

  function reveal(x,y){
    if(gameOver) return;
    const c = grid[idx(x,y)];
    if(c.flagged || c.revealed) return;

    if(firstReveal){
      placeMinesSafe(x,y);
      firstReveal = false;
      startTimer();
    }

    // Si cae mina -> perder
    if(c.mine){
      c.revealed = true;
      paintCell(x,y);
      lose(x,y);
      return;
    }

    // Flood fill para ceros
    floodReveal(x,y);
    beep(650, .045, "sine", .015);
    checkWin();
  }

  function floodReveal(sx,sy){
    const q = [{x:sx,y:sy}];
    while(q.length){
      const {x,y} = q.shift();
      const i = idx(x,y);
      const cell = grid[i];
      if(cell.revealed || cell.flagged) continue;
      cell.revealed = true;
      paintCell(x,y);

      if(cell.adj===0){
        for(const n of neighbors(x,y)){
          const ni = idx(n.x,n.y);
          if(!grid[ni].revealed && !grid[ni].flagged) q.push(n);
        }
      }
    }
  }

  function chord(x,y){
    if(gameOver) return;
    const c = grid[idx(x,y)];
    if(!c.revealed || c.adj<=0) return;
    const neigh = neighbors(x,y);
    const flaggedAround = neigh.reduce((a,n)=> a + (grid[idx(n.x,n.y)].flagged?1:0), 0);
    if(flaggedAround !== c.adj) return;
    // Revelar vecinos no marcados
    for(const n of neigh){
      const ni = idx(n.x,n.y);
      const nc = grid[ni];
      if(!nc.flagged && !nc.revealed){
        if(nc.mine){
          nc.revealed = true;
          paintCell(n.x,n.y);
          return lose(n.x,n.y);
        }else{
          floodReveal(n.x,n.y);
        }
      }
    }
    checkWin();
  }

  function checkWin(){
    if(gameOver) return;
    for(let i=0;i<grid.length;i++){
      const c = grid[i];
      if(!c.mine && !c.revealed) return;
    }
    // Gan√≥
    gameOver = true;
    stopTimer();
    resetBtn.textContent = "üòé";
    showBanner("¬°Victoria! üêæ‚ú®", "var(--accent-blue)");
    confettiBurst(56);
    saveBestIfNeeded();
    beep(880,.09,"triangle",.035);
    beep(990,.08,"triangle",.03);
  }

  function lose(bx,by){
    gameOver = true;
    stopTimer();
    // Revelar todo
    for(let y=0;y<H;y++){
      for(let x=0;x<W;x++){
        const c = grid[idx(x,y)];
        if(c.mine) c.revealed = true;
        paintCell(x,y);
      }
    }
    // animar celda explotada
    const el = $("#c_"+idx(bx,by));
    if(el){
      el.style.transform="scale(1.05)";
      setTimeout(()=> el.style.transform="", 150);
    }
    resetBtn.textContent = "üòµ";
    showBanner("¬°Ups! Encontraste una pata üêæüí•", "var(--accent-rose)");
    beep(180,.12,"sawtooth",.06);
  }

  /** ------------------ Teclado ------------------ */
  function onBoardKey(e){
    if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," ","KeyF","KeyR","KeyM"].includes(e.code)) return;
    e.preventDefault();
    const {x,y} = xyFromIndex(focusIndex);
    let nx=x, ny=y;

    if(e.code==="ArrowLeft") nx = clamp(x-1,0,W-1);
    if(e.code==="ArrowRight") nx = clamp(x+1,0,W-1);
    if(e.code==="ArrowUp") ny = clamp(y-1,0,H-1);
    if(e.code==="ArrowDown") ny = clamp(y+1,0,H-1);

    if(nx!==x || ny!==y){
      focusIndex = idx(nx,ny);
      setFocusTo(focusIndex);
      return;
    }

    if(e.code==="Enter" || e.code===" "){
      reveal(x,y);
    }else if(e.code==="KeyF"){
      toggleFlag(x,y);
    }else if(e.code==="KeyR"){
      reset();
    }else if(e.code==="KeyM"){
      themeToggle.checked = !themeToggle.checked;
      applyTheme();
    }
  }
  function setFocusTo(i){
    const prev = document.querySelector(".cell[tabindex='0']");
    if(prev) prev.setAttribute("tabindex","-1");
    const el = $("#c_"+i);
    if(el){
      el.setAttribute("tabindex","0");
      el.focus({preventScroll:true});
    }
  }

  /** ------------------ Controles UI ------------------ */
  resetBtn.addEventListener("click", ()=> reset());
  difficultySel.addEventListener("change", ()=> setDifficulty(difficultySel.value));
  themeToggle.addEventListener("change", applyTheme);
  soundToggle.addEventListener("change", ()=>{
    soundsOn = soundToggle.checked;
    if(soundsOn){ ensureAudio(); beep(700,.05,"sine",.02); }
  });

  function applyTheme(){
    appRoot.setAttribute("data-theme", themeToggle.checked ? "dark" : "light");
  }

  /** ------------------ Depuraci√≥n (expuestos) ------------------ */
  window.revealAll = function(){
    grid.forEach(c=> c.revealed = true);
    for(let y=0;y<H;y++) for(let x=0;x<W;x++) paintCell(x,y);
  };
  window.seedTest = function(){
    // Semilla de pruebas: una franja diagonal de minas
    grid.forEach(c=>{ c.mine=false; c.revealed=false; c.flagged=false; c.adj=0; });
    for(let i=0;i<Math.min(W,H);i++) grid[idx(i,i)].mine = true;
    for(let y=0;y<H;y++) for(let x=0;x<W;x++){
      const i = idx(x,y);
      if(grid[i].mine){ grid[i].adj=-1; continue; }
      grid[i].adj = neighbors(x,y).reduce((a,n)=> a+(grid[idx(n.x,n.y)].mine?1:0),0);
    }
    firstReveal=false; renderBoard();
  };

  /** ------------------ Lanzamiento ------------------ */
  (function launch(){
    // Usar dificultad inicial por defecto
    setDifficulty(difficultySel.value);
    applyTheme();
    // Habilitar audio al primer gesto del usuario para iOS
    document.addEventListener("pointerdown", ()=> ensureAudio(), {once:true});
  })();

})();
</script>
</body>
</html>
